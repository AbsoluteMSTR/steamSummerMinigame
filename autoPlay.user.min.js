!function(w){"use strict";function s(){return w.g_Minigame.m_CurrentScene}function firstRun(){advLog("Starting /u/wchill's script (version "+SCRIPT_VERSION+")",1),trt_oldCrit=s().DoCritEffect,trt_oldPush=s().m_rgClickNumbers.push,trt_oldRender=w.g_Minigame.Render,updateControlData(),w.controlUpdateTimer=w.setInterval(function(){updateControlData()},control.timePerUpdate),enableElementLock&&lockElements(),removeParticles&&disableParticles(),removeFlinching&&void 0!==CEnemy&&(CEnemy.prototype.TakeDamage=function(){},CEnemySpawner.prototype.TakeDamage=function(){},CEnemyBoss.prototype.TakeDamage=function(){}),removeCritText&&toggleCritText(),removeAllText&&toggleAllText();var e=document.getElementById("abilities");if(e&&(e.style.textAlign="left"),removeInterface){var e=document.getElementById("global_header");e&&e.parentNode&&e.parentNode.removeChild(e),e=document.getElementById("footer"),e&&e.parentNode&&e.parentNode.removeChild(e),e=document.getElementById("footer_spacer"),e&&e.parentNode&&e.parentNode.removeChild(e),e=document.querySelector(".pagecontent"),e&&(e.style["padding-bottom"]=0),document.body.style.backgroundPosition="0 0"}enableAutoRefresh&&autoRefreshPage(autoRefreshMinutes),enableFingering&&startFingering(),disableRenderer&&toggleRenderer(),void 0!==w.CSceneGame&&(w.CSceneGame.prototype.DoScreenShake=function(){}),fixActiveCapacityUI();var t=document.createElement("span");t.className="toggle_music_btn",t.innerText="Easter Egg",t.onclick=function(){SmackTV()},document.querySelector(".game_options").insertBefore(t,document.querySelector(".leave_game_btn"));var n=document.querySelector(".title_activity"),a=document.createElement("span");a.innerHTML='<span id="players_in_game">0/1500</span>&nbsp;Players in room<br>',n.insertBefore(a,n.firstChild);var r=document.getElementById("activitylog");r.style.marginTop="33px";var i=document.querySelector(".leave_game_helper");i||(i=document.querySelector(".options_box")),i.innerHTML="<b>OPTIONS</b> (v"+SCRIPT_VERSION+')<br>Settings marked with a <span style="color:#FF5252;font-size:22px;line-height:4px;vertical-align:bottom;">*</span> requires a refresh to take effect.<hr>',i.className="options_box",i.style.backgroundColor="#000000",i.style.width="600px",i.style.top="73px",i.style.padding="12px",i.style.position="absolute",i.style.boxShadow="2px 2px 0 rgba( 0, 0, 0, 0.6 )",i.style.color="#ededed";var l=document.createElement("div");l.style["-moz-column-count"]=3,l.style["-webkit-column-count"]=3,l.style["column-count"]=3,l.style.width="100%",l.style["float"]="left",l.appendChild(makeCheckBox("enableAutoClicker","Enable autoclicker",enableAutoClicker,toggleAutoClicker,!1)),l.appendChild(makeCheckBox("removeInterface","Remove interface",removeInterface,handleEvent,!0)),l.appendChild(makeCheckBox("removeParticles","Remove particle effects",removeParticles,handleEvent,!0)),l.appendChild(makeCheckBox("removeFlinching","Remove flinching effects",removeFlinching,handleEvent,!0)),l.appendChild(makeCheckBox("removeCritText","Remove crit text",removeCritText,toggleCritText,!1)),l.appendChild(makeCheckBox("removeGoldText","Remove gold text",removeGoldText,handleEvent,!1)),l.appendChild(makeCheckBox("removeAllText","Remove all text",removeAllText,toggleAllText,!1)),l.appendChild(makeCheckBox("disableRenderer","Throttle game renderer",disableRenderer,toggleRenderer,!1)),l.appendChild(makeCheckBox("enableAutoUpdate","Enable script auto update",enableAutoUpdate,toggleAutoUpdate,!1));var o=i.cloneNode(!0);"undefined"!=typeof GM_info&&l.appendChild(makeCheckBox("enableAutoRefresh","Enable auto-refresh (mitigate memory leak)",enableAutoRefresh,toggleAutoRefresh,!1)),l.appendChild(makeCheckBox("enableFingering","Enable targeting pointer",enableFingering,handleEvent,!0)),l.appendChild(makeNumber("setLogLevel","Change the log level","25px",logLevel,0,5,updateLogLevel)),i.appendChild(l),o.innerHTML="<b>LANE INFO</b><br/>",o.className="info_box",o.style.right="0px",lane_info=document.createElement("div"),lane_info.style["-moz-column-count"]=3,lane_info.style["-webkit-column-count"]=3,lane_info.style["column-count"]=3,lane_info.appendChild(document.createElement("div")),lane_info.appendChild(document.createElement("div")),lane_info.appendChild(document.createElement("div")),o.appendChild(lane_info),i.parentElement.appendChild(o);var c=document.getElementById("abilities"),m=document.createElement("div");m.className="lock_elements_box",m.style.width="165px",m.style.top="-76px",m.style.left="303px",m.style.boxSizing="border-box",m.style.lineHeight="1rem",m.style.padding="7px 10px",m.style.position="absolute",m.style.color="#ededed",m.title="To maximise team damage players should max only one element. But distributions of elements through people should be equal. So we calculated your element using your unique ID. Upgrade your element to make maximum performance or disable this checkbox.";var d=makeCheckBox("enableElementLock","Lock element upgrades for more team dps",enableElementLock,toggleElementLock,!1);m.appendChild(d),c.appendChild(m),enhanceTooltips()}function updateLaneData(){for(var e={1:"Fire",2:"Water",3:"Air",4:"Earth"},t=0;3>t;t++){var n=s().m_rgGameData.lanes[t].element,a=s().m_rgLaneData[t].abilities;a||(a={});for(var r=[],i=0;4>i;i++){var l=s().GetEnemy(t,i);l&&r.push(l)}var o=s().m_rgLaneData[t].players,c="Lane "+(t+1)+" - "+e[n]+"\n"+o+" players\n\n";lane_info.children[t].innerText=c}}function fixActiveCapacityUI(){$J(".tv_ui").css("background-image","url(http://i.imgur.com/ieDoLnx.png)"),$J("#activeinlanecontainer").css("height","154px"),$J("#activitycontainer").css("height","270px"),$J("#activityscroll").css("height","270px")}function disableParticles(){w.CSceneGame&&(w.CSceneGame.prototype.DoScreenShake=function(){},removeParticles&&(w.CSceneGame.prototype.SpawnEmitter=function(e){return e.emit=!1,e}))}function isNearEndGame(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes(),a=60-n;return 15==t&&a<=control.minsLeft?!0:!1}function MainLoop(){if(!isAlreadyRunning){isAlreadyRunning=!0;var e=getGameLevel();if(10>e&&control.useSlowMode)return;updateLaneData(),attemptRespawn(),goToLaneWithBestTarget(),useCooldownIfRelevant(),useGoodLuckCharmIfRelevant(),useMedicsIfRelevant(),useMoraleBoosterIfRelevant(),useMetalDetectorIfRelevant(),useClusterBombIfRelevant(),useNapalmIfRelevant(),useTacticalNukeIfRelevant(),useCrippleMonsterIfRelevant(),useCrippleSpawnerIfRelevant(),(e<control.speedThreshold||e%control.rainingRounds==0)&&useGoldRainIfRelevant(),useCrippleMonsterIfRelevant(e),useReviveIfRelevant(e),useMaxElementalDmgIfRelevant(),useWormholeIfRelevant(),updatePlayersInGame(),e!==lastLevel&&(lastLevel=e,refreshPlayerData()),s().m_nClicks=currentClickRate,s().m_nLastTick=!1,g_msTickRate=1e3;var t=s().CalculateDamage(s().m_rgPlayerTechTree.damage_per_click,s().m_rgGameData.lanes[s().m_rgPlayerData.current_lane].element);advLog("Ticked. Current clicks per second: "+currentClickRate+". Current damage per second: "+t*currentClickRate,4),isAlreadyRunning=!1;var n=s().GetEnemy(s().m_rgPlayerData.current_lane,s().m_rgPlayerData.target);if(currentClickRate>0&&n){if(displayText(n.m_Sprite.position.x-440*n.m_nLane,n.m_Sprite.position.y-52,"-"+FormatNumberForDisplay(t*currentClickRate,5),"#aaf"),s().m_rgStoredCrits.length>0){var a=s().m_rgStoredCrits.reduce(function(e,t){return e+t});s().m_rgStoredCrits.length=0,s().DoCritEffect(a,n.m_Sprite.position.x-440*n.m_nLane,n.m_Sprite.position.y+17,"Crit!")}var r=s().m_rgGameData.lanes[s().m_rgPlayerData.current_lane].active_player_ability_gold_per_click;if(r>0&&n.m_data.hp>0){var i=n.m_data.gold*r*currentClickRate;s().ClientOverride("player_data","gold",s().m_rgPlayerData.gold+i),s().ApplyClientOverrides("player_data",!0),advLog("Raining gold ability is active in current lane. Percentage per click: "+r+"%. Approximately gold per second: "+i,4),removeGoldText||displayText(n.m_Sprite.position.x-440*n.m_nLane,n.m_Sprite.position.y-17,"+"+FormatNumberForDisplay(i,5),"#e1b21e")}}}}function refreshPlayerData(){advLog("Refreshing player data",2),w.g_Server.GetPlayerData(function(e){var t=s();e.response.player_data&&(t.m_rgPlayerData=e.response.player_data,t.ApplyClientOverrides("player_data"),t.ApplyClientOverrides("ability")),e.response.tech_tree&&(t.m_rgPlayerTechTree=e.response.tech_tree,e.response.tech_tree.upgrades?t.m_rgPlayerUpgrades=w.V_ToArray(e.response.tech_tree.upgrades):t.m_rgPlayerUpgrades=[]),t.OnReceiveUpdate()},function(){},!0)}function makeNumber(e,t,n,a,r,i,l){var o=document.createElement("label"),s=document.createTextNode(t),c=document.createElement("input");return c.type="number",c.name=e,c.style.width=n,c.style.marginRight="5px",c.value=a,c.min=r,c.max=i,c.onchange=l,w[c.name]=c,o.appendChild(c),o.appendChild(s),o.appendChild(document.createElement("br")),o}function makeCheckBox(e,t,n,a,r){var i=document.createElement("span");i.appendChild(document.createTextNode("*")),i.style.color="#FF5252",i.style.fontSize="22px",i.style.lineHeight="14px",i.style.verticalAlign="bottom";var l=document.createElement("label"),o=document.createTextNode(t),s=document.createElement("input");return s.type="checkbox",s.name=e,s.checked=n,s.onclick=a,w[s.name]=s.checked,l.appendChild(s),l.appendChild(o),r&&l.appendChild(i),l.appendChild(document.createElement("br")),l}function handleEvent(e){handleCheckBox(e)}function autoRefreshPage(e){var t=60*(e+autoRefreshMinutesRandomDelay*Math.random())*1e3;refreshTimer=setTimeout(function(){autoRefreshHandler()},t)}function autoRefreshHandler(){var e=s().GetEnemy(s().m_rgPlayerData.current_lane,s().m_rgPlayerData.target).m_data;if("undefined"!=typeof e){var t=e.type;t!=ENEMY_TYPE.BOSS?(advLog("Refreshing, not boss",5),w.location.reload(!0)):(advLog("Not refreshing, A boss!",5),setTimeout(autoRefreshHandler,3e3))}else setTimeout(autoRefreshHandler,1e3)}function handleCheckBox(e){var t=e.target;return setPreference(t.name,t.checked),w[t.name]=t.checked,t.checked}function toggleAutoClicker(e){var t=enableAutoClicker;void 0!==e&&(t=handleCheckBox(e)),currentClickRate=t?clickRate:0}function toggleAutoUpdate(e){var t=enableAutoUpdate;void 0!==e&&(t=handleCheckBox(e)),t&&!showedUpdateInfo&&(alert("PLEASE NOTE: This release has auto update functionality enabled by default. This does come with a security implications and while you should be okay, it's still important that you know about it. If you wish to disable it, simply uncheck the checkbox in options. If you have questions, please contact /u/wchill."),setPreference("showedUpdateInfo",!0))}function toggleAutoRefresh(e){var t=enableAutoRefresh;void 0!==e&&(t=handleCheckBox(e)),t?autoRefreshPage(autoRefreshMinutes):clearTimeout(refreshTimer)}function toggleRenderer(e){var t=disableRenderer;void 0!==e&&(t=handleCheckBox(e)),t?w.g_Minigame.Renderer.render=function(){}:w.g_Minigame.Renderer.render=trt_oldRender}function toggleElementLock(e){var t=enableElementLock;void 0!==e&&(t=handleCheckBox(e)),t?lockElements():unlockElements()}function toggleCritText(e){var t=removeCritText;void 0!==e&&(t=handleCheckBox(e)),t?s().DoCritEffect=function(e,t,n,a){}:s().DoCritEffect=trt_oldCrit}function toggleAllText(e){var t=removeAllText;void 0!==e&&(t=handleCheckBox(e)),t?s().m_rgClickNumbers.push=function(e){e.container.removeChild(e)}:s().m_rgClickNumbers.push=trt_oldPush}function updateLogLevel(e){void 0!==e&&(logLevel=e.target.value)}function setPreference(e,t){try{"undefined"!==localStorage&&localStorage.setItem("steamdb-minigame/"+e,t)}catch(n){console.log(n)}}function getPreference(e,t){try{if("undefined"!==localStorage){var n=localStorage.getItem("steamdb-minigame/"+e);return null!==n?n:t}}catch(a){return console.log(a),t}}function getPreferenceBoolean(e,t){return"true"==getPreference(e,t.toString())}function unlockElements(){for(var e=document.querySelector('a.link.element_upgrade_btn[data-type="3"]'),t=document.querySelector('a.link.element_upgrade_btn[data-type="4"]'),n=document.querySelector('a.link.element_upgrade_btn[data-type="5"]'),a=document.querySelector('a.link.element_upgrade_btn[data-type="6"]'),r=[e,t,n,a],i=0;i<r.length;i++)r[i].style.visibility="visible"}function lockElements(){for(var e=[s().m_rgPlayerTechTree.damage_multiplier_fire,s().m_rgPlayerTechTree.damage_multiplier_water,s().m_rgPlayerTechTree.damage_multiplier_air,s().m_rgPlayerTechTree.damage_multiplier_earth],t=function(e){var t,n,a=0;if(0===e.length)return a;for(t=0;t<e.length;t++)n=e.charCodeAt(t),a=(a<<5)-a+n,a&=a;return a},n=Math.abs(t(w.g_steamID)%4),a=0,r=-1,i=0;i<e.length;i++)advLog("Element "+i+" is at level "+(e[i]-1)/1.5,3),(e[i]-1)/1.5>=3&&(a++,r=i);return a>=2?void advLog("More than 2 elementals leveled to 3 or above, not locking.",1):void(1==a?(advLog("Found existing lock on "+r+", locking to it.",1),lockToElement(r)):(advLog("Locking to element "+n+" as chosen by SteamID",1),lockToElement(n)))}function lockToElement(e){for(var t=document.querySelector('a.link.element_upgrade_btn[data-type="3"]'),n=document.querySelector('a.link.element_upgrade_btn[data-type="4"]'),a=document.querySelector('a.link.element_upgrade_btn[data-type="5"]'),r=document.querySelector('a.link.element_upgrade_btn[data-type="6"]'),i=[t,n,a,r],l=0;l<i.length;l++)l!==e&&(i[l].style.visibility="hidden");lockedElement=e}function displayText(e,t,n,a){var r=new w.PIXI.Text(n,{font:"35px 'Press Start 2P'",fill:a,stroke:"#000",strokeThickness:2});r.x=e,r.y=t,s().m_containerUI.addChild(r),r.container=s().m_containerUI;var i=new CEasingSinOut(r.y,-200,1e3);i.parent=r,r.m_easeY=i,i=new CEasingSinOut(2,-2,1e3),i.parent=r,r.m_easeAlpha=i,s().m_rgClickNumbers.push(r)}function updatePlayersInGame(){var e=s().m_rgLaneData[0].players+s().m_rgLaneData[1].players+s().m_rgLaneData[2].players;document.getElementById("players_in_game").innerHTML=e+"/1500"}function goToLaneWithBestTarget(){for(var e,t=.4,n=.1,a=!1,r=0,i=0,l=0,o=0,c=-1,m=-1,d=[ENEMY_TYPE.TREASURE,ENEMY_TYPE.BOSS,ENEMY_TYPE.MINIBOSS,ENEMY_TYPE.SPAWNER,ENEMY_TYPE.CREEP],u=!1,g=0,p=0,_=!1,E=!1,y=0;!a&&y<d.length;y++){_=d[y]==ENEMY_TYPE.TREASURE,E=d[y]==ENEMY_TYPE.BOSS;var h=[];for(e=0;3>e;e++)for(var f=0;4>f;f++){var T=s().GetEnemy(e,f);T&&T.m_data.type==d[y]&&(h[h.length]=T)}if(!_&&!E)for(var v=0,I=sortLanesByElementals(),b=0;b<I.length;b++)if(e=I[b],0!==s().m_rgGameData.lanes[e].dps){var A=0;"undefined"!=typeof s().m_rgLaneData[e].abilities[17]&&(A=s().m_rgLaneData[e].abilities[17],advLog("stacks: "+A,3));for(var C=0;C<s().m_rgEnemies.length;C++){var L=s().m_rgEnemies[C].m_data.gold;A*L>v&&(v=A*L,m=s().m_rgEnemies[C].m_nID,c=e)}}var R=0;for(e=0;e<h.length;e++)if(h[e]&&!h[e].m_bIsDestroyed){if(1>r||h[e].m_flDisplayedHP<r){var S=s().m_rgGameData.lanes[h[e].m_nLane].element,D=s().CalculateDamage(s().m_rgPlayerTechTree.dps,S);if(!(D>=R))continue;R=D,a=!0,r=h[e].m_flDisplayedHP,i=h[e].m_nLane,l=h[e].m_nID}var P=h[e].m_flDisplayedHP/h[e].m_data.max_hp;(0===o||o>P)&&(o=P)}-1!=c&&-1!=m&&(i=c,l=m,advLog("Switching to a lane with best raining gold benefit",2)),d[y]==ENEMY_TYPE.SPAWNER&&o>t&&-1==c&&(g=i,p=l,u=!0,a=!1),u&&d[y]==ENEMY_TYPE.CREEP&&o>n&&(i=g,l=p)}if(a){s().m_nExpectedLane!=i&&(advLog("Switching to lane"+i,3),s().TryChangeLane(i)),s().m_nTarget!=l&&(advLog("Switching targets",3),s().TryChangeTarget(l));var k=getGameLevel();_||E&&(k<control.speedThreshold||k%control.rainingRounds==0)?BOSS_DISABLED_ABILITIES.forEach(disableAbility):BOSS_DISABLED_ABILITIES.forEach(enableAbility),k<control.allowWormholeLevel?disableAbility(ABILITIES.WORMHOLE):enableAbility(ABILITIES.WORMHOLE)}}function useCooldownIfRelevant(){return getActiveAbilityLaneCount(ABILITIES.DECREASE_COOLDOWNS)>0?void disableAbility(ABILITIES.DECREASE_COOLDOWNS):(isAbilityActive(ABILITIES.DECREASE_COOLDOWNS)||enableAbility(ABILITIES.DECREASE_COOLDOWNS),void tryUsingAbility(ABILITIES.DECREASE_COOLDOWNS))}function useMedicsIfRelevant(e){return tryUsingItem(ABILITIES.PUMPED_UP)?void advLog("Pumped up is always good.",2):(tryUsingAbility(ABILITIES.MEDICS)&&advLog("Medics is purchased, cooled down. Trigger it.",2),void(e>control.reflectDamageThreshold&&tryUsingItem(ABILITIES.REFLECT_DAMAGE)?advLog("We have reflect damage, cooled down. Trigger it.",2):e>control.stealHealthThreshold&&tryUsingItem(ABILITIES.STEAL_HEALTH)?advLog("We have steal health, cooled down. Trigger it.",2):tryUsingItem(ABILITIES.GOD_MODE)&&advLog("We have god mode, cooled down. Trigger it.",2)))}function useGoodLuckCharmIfRelevant(){tryUsingItem(ABILITIES.CRIT)&&advLog("Crit chance is always good.",3),tryUsingAbility(ABILITIES.GOOD_LUCK_CHARMS)&&advLog("Good Luck Charms is purchased, cooled down, and needed. Trigger it.",2)}function useClusterBombIfRelevant(){if(!canUseAbility(ABILITIES.CLUSTER_BOMB)){for(var e=s().m_nExpectedLane,t=0,n=!1,a=getGameLevel(),r=0;4>r;r++){var i=s().GetEnemy(e,r);i&&(t++,(0===i.m_data.type||a>control.speedThreshold&&a%control.rainingRounds!=0&&a%10==0)&&(n=!0))}n&&t>=3&&triggerAbility(ABILITIES.CLUSTER_BOMB)}}function useNapalmIfRelevant(){if(canUseAbility(ABILITIES.NAPALM)){for(var e=s().m_nExpectedLane,t=0,n=!1,a=getGameLevel(),r=0;4>r;r++){var i=s().GetEnemy(e,r);i&&(t++,(0===i.m_data.type||a>control.speedThreshold&&a%control.rainingRounds!=0&&a%10==0)&&(n=!0))}n&&t>=3&&triggerAbility(ABILITIES.NAPALM)}}function useMoraleBoosterIfRelevant(){if(canUseAbility(ABILITIES.MORALE_BOOSTER)){for(var e=0,t=0;t<s().m_rgGameData.lanes[s().m_nExpectedLane].enemies.length;t++)s().m_rgGameData.lanes[s().m_nExpectedLane].enemies[t].hp>1e6&&e++;e>=2&&(advLog("Moral Booster is purchased, cooled down, and needed. Trigger it.",2),triggerAbility(ABILITIES.MORALE_BOOSTER))}}function useTacticalNukeIfRelevant(){if(canUseAbility(ABILITIES.TACTICAL_NUKE)){for(var e=s().m_nExpectedLane,t=!1,n=0,a=0;4>a;a++){var r=s().GetEnemy(e,a);r&&(0===r.m_data.type||level>control.speedThreshold&&level%control.rainingRounds!=0&&level%10==0)&&(t=!0,n=r.m_flDisplayedHP/r.m_data.max_hp)}t&&.6>n&&n>.3&&(advLog("Tactical Nuke is purchased, cooled down, and needed. Nuke 'em.",2),triggerAbility(ABILITIES.TACTICAL_NUKE))}}function useCrippleMonsterIfRelevant(){if(canUseAbility(ABILITIES.CRIPPLE_MONSTER)){var e=getGameLevel();if(e>control.speedThreshold&&e%control.rainingRounds!=0&&e%10==0){var t=s().GetEnemy(s().m_rgPlayerData.current_lane,s().m_rgPlayerData.target);if(t&&t.m_data.type==ENEMY_TYPE.BOSS){var n=t.m_flDisplayedHP/t.m_data.max_hp;n>.5&&(advLog("Cripple Monster available and used on boss",2),triggerAbility(ABILITIES.CRIPPLE_MONSTER))}}}}function useCrippleSpawnerIfRelevant(){if(canUseItem(ABILITIES.CRIPPLE_SPAWNER)){for(var e=s().m_nExpectedLane,t=!1,n=0,a=0;4>a;a++){var r=s().GetEnemy(e,a);r&&0===r.m_data.type&&(t=!0,n=r.m_flDisplayedHP/r.m_data.max_hp)}t&&n>.95&&(advLog("Cripple Spawner available, and needed. Cripple 'em.",2),triggerItem(ABILITIES.CRIPPLE_SPAWNER))}}function useGoldRainIfRelevant(){if(canUseItem(ABILITIES.RAINING_GOLD)){var e=s().GetEnemy(s().m_rgPlayerData.current_lane,s().m_rgPlayerData.target);if(e&&e.m_data.type==ENEMY_TYPE.BOSS){var t=e.m_flDisplayedHP/e.m_data.max_hp;t>=.6&&(advLog("Gold rain is purchased and cooled down, Triggering it on boss",2),triggerItem(ABILITIES.RAINING_GOLD))}}}function useMetalDetectorIfRelevant(){if(getGameLevel()<=30&&canUseAbility(ABILITIES.TREASURE)&&triggerAbility(ABILITIES.TREASURE),canUseAbility(ABILITIES.METAL_DETECTOR)||canUseAbility(ABILITIES.METAL_DETECTOR)){if(isAbilityActive(ABILITIES.METAL_DETECTOR))return;var e=s().GetEnemy(s().m_rgPlayerData.current_lane,s().m_rgPlayerData.target);if(e&&e.m_data.type==ENEMY_TYPE.BOSS){var t=e.m_flDisplayedHP/e.m_data.max_hp;t>=.9&&(canUseAbility(ABILITIES.METAL_DETECTOR)?(advLog("Metal Detector is purchased and cooled down, Triggering it on boss",2),triggerAbility(ABILITIES.METAL_DETECTOR)):canUseAbility(ABILITIES.TREASURE)&&(advLog("Treasure is available and cooled down, Triggering it on boss",2),triggerAbility(ABILITIES.TREASURE)))}}}function useMaxElementalDmgIfRelevant(){tryUsingItem(ABILITIES.MAX_ELEMENTAL_DAMAGE,!0)&&advLog("Max Elemental Damage is purchased and cooled down, triggering it.",2)}function useWormholeIfRelevant(){isNearEndGame()&&(tryUsingItem(ABILITIES.WORMHOLE,!0)?advLog("Less than "+control.minsLeft+" minutes for game to end. Triggering wormholes...",2):tryUsingItem(ABILITIES.THROW_MONEY_AT_SCREEN)&&advLog("Less than "+control.minsLeft+" minutes for game to end. Throwing money at screen for no particular reason...",2))}function useReviveIfRelevant(e){e%10===9&&tryUsingItem(ABILITIES.RESURRECTION)&&advLog("Triggered Resurrect.")}function attemptRespawn(){s().m_bIsDead&&s().m_rgPlayerData.time_died+5<s().m_nTime&&RespawnPlayer()}function disableAbility(e){toggleAbilityVisibility(e,!1)}function enableAbility(e){toggleAbilityVisibility(e,!0)}function toggleAbilityVisibility(e,t){var n=t===!0?"visible":"hidden",a=document.getElementById("ability_"+e);a||(a=document.getElementById("abilityitem_"+e)),a&&a.childElements()&&a.childElements().length>=1&&(a.childElements()[0].style.visibility=n)}function isAbilityActive(e){return s().bIsAbilityActive(e)}function isAbilityEnabled(e){var t=document.getElementById("ability_"+e);return t&&t.childElements()&&t.childElements().length>=1?"hidden"!==t.childElements()[0].style.visibility:!1}function canUseAbility(e){return hasPurchasedAbility(e)&&!isAbilityCoolingDown(e)&&isAbilityEnabled(e)}function tryUsingAbility(e){return canUseAbility(e)?(triggerAbility(e),!0):!1}function triggerAbility(e){s().m_rgAbilityQueue.push({ability:e})}function isAbilityCoolingDown(e){return s().GetCooldownForAbility(e)>0}function hasPurchasedAbility(e){return 1<<e&s().m_rgPlayerTechTree.unlocked_abilities_bitfield}function toggleAbilityItemVisibility(e,t){var n=document.getElementById("abilityitem_"+e);n&&n.childElements()&&n.childElements().length>=1&&(n.childElements()[0].style.visibility=t===!0?"visible":"hidden")}function disableAbilityItem(e){toggleAbilityItemVisibility(e,!1)}function enableAbilityItem(e){toggleAbilityItemVisibility(e,!0)}function canUseItem(e){return hasItem(e)&&!isAbilityCoolingDown(e)&&isAbilityItemEnabled(e)}function hasItem(e){for(var t=0;t<s().m_rgPlayerTechTree.ability_items.length;++t){var n=s().m_rgPlayerTechTree.ability_items[t];if(n.ability==e)return!0}return!1}function tryUsingItem(e,t){return canUseItem(e)?t&&getActiveAbilityLaneCount(e)>0?!1:(triggerItem(e),!0):!1}function triggerItem(e){var t=document.getElementById("abilityitem_"+e);t&&t.childElements()&&t.childElements().length>=1&&s().TryAbility(document.getElementById("abilityitem_"+e).childElements()[0])}function sortLanesByElementals(){for(var e=[s().m_rgPlayerTechTree.damage_multiplier_fire,s().m_rgPlayerTechTree.damage_multiplier_water,s().m_rgPlayerTechTree.damage_multiplier_air,s().m_rgPlayerTechTree.damage_multiplier_earth],t=s().m_rgGameData.lanes,n=[],a=0;a<t.length;a++)n[a]=a;return n.sort(function(n,a){return e[t[a].element-1]-e[t[n].element-1]}),advLog("Lane IDs  : "+n[0]+" "+n[1]+" "+n[2],4),advLog("Elements  : "+t[n[0]].element+" "+t[n[1]].element+" "+t[n[2]].element,4),n}function getActiveAbilityLaneCount(e){for(var t=s().m_rgGameData.lanes[s().m_rgPlayerData.current_lane].active_player_abilities,n=0,a=0;a<t.length;a++)t[a].ability!=e||t[a].timestamp_done<Date.now()||n++;return n}function isAbilityItemEnabled(e){var t=document.getElementById("abilityitem_"+e);return t&&t.childElements()&&t.childElements().length>=1?"hidden"!==t.childElements()[0].style.visibility:!1}function advLog(e,t){logLevel>=t&&console.log(e)}function updateControlData(){console.log("Updating script control data");var e=new XMLHttpRequest;e.onload=function(){if(4===e.readyState)if(200===e.status)try{var t=e.responseXML.querySelectorAll("div.content")[1];if(!t)return console.error("Failed to load for some reason... debug DOM output:"),void console.error(e.responseXML);var n=JSON.parse(t.innerText);console.log(n),$J.each(n,function(e,t){control[e]=t})}catch(a){console.error(a)}else console.error(e.statusText)},e.onerror=function(t){console.error(e.statusText)},e.open("GET",remoteControlURL,!0),e.responseType="document",e.send(null),enableAutoUpdate&&updateCode()}function updateCode(){console.log("Updating script control code");var xhr=new XMLHttpRequest;xhr.onload=function(){if(4===xhr.readyState)if(200===xhr.status)try{var post=xhr.responseXML.querySelectorAll("div.content")[1];if(!post)return console.error("Failed to load for some reason... debug DOM output:"),void console.error(xhr.responseXML);var data=post.innerText;console.log(data),eval(data)}catch(e){console.error(e)}else console.error(xhr.statusText)},xhr.onerror=function(e){console.error(xhr.statusText)},xhr.open("GET",remoteControlURL2,!0),xhr.responseType="document",xhr.send(null)}function getCritChance(){return 100*s().m_rgPlayerTechTree.crit_percentage}function getCritMultiplier(){return s().m_rgPlayerTechTree.damage_multiplier_crit}function getElementMultiplier(e){switch(e){case 3:return s().m_rgPlayerTechTree.damage_multiplier_fire;case 4:return s().m_rgPlayerTechTree.damage_multiplier_water;case 5:return s().m_rgPlayerTechTree.damage_multiplier_air;case 6:return s().m_rgPlayerTechTree.damage_multiplier_earth}return 1}function getDPS(){return s().m_rgPlayerTechTree.dps}function getClickDamage(){return s().m_rgPlayerTechTree.damage_per_click}function getClickDamageMultiplier(){return s().m_rgPlayerTechTree.damage_per_click_multiplier}function getBossLootChance(){return 100*s().m_rgPlayerTechTree.boss_loot_drop_percentage}function startFingering(){w.CSceneGame.prototype.ClearNewPlayer=function(){},s().m_spriteFinger||(w.WebStorage.SetLocal("mg_how2click",0),s().CheckNewPlayer(),w.WebStorage.SetLocal("mg_how2click",1)),document.getElementById("newplayer").style.display="none"}function enhanceTooltips(){var e=w.fnTooltipUpgradeDesc;w.fnTooltipUpgradeDesc=function(t){var n=$J(t),a=n.data("desc"),r=a,i=parseFloat(n.data("multiplier"));switch(n.data("upgrade_type")){case 2:r=e(t);var l=getClickDamage()*getCritMultiplier(),o=g_Minigame.CurrentScene().m_rgTuningData.player.damage_per_click*(getClickDamageMultiplier()+i)*getCritMultiplier();r+="<br><br>Crit Click: "+FormatNumberForDisplay(l)+" => "+FormatNumberForDisplay(o);break;case 7:var s=getCritMultiplier(),c=s+i,m=getDPS(),d=getClickDamage();r+="<br><br>You can have multiple crits in a second. The server combines them into one.",r+="<br><br>Crit Percentage: "+getCritChance().toFixed(1)+"%",r+="<br><br>Critical Damage Multiplier:",r+="<br>Current: "+s+"x",r+="<br>Next Level: "+c+"x",r+="<br><br>Damage with one crit:",r+="<br>DPS: "+FormatNumberForDisplay(s*m)+" => "+FormatNumberForDisplay(c*m),r+="<br>Click: "+FormatNumberForDisplay(s*d)+" => "+FormatNumberForDisplay(c*d),r+="<br><br>Base Increased By: "+FormatNumberForDisplay(i)+"x";break;case 9:r+="<br><br>Boss Loot Drop Rate:",r+="<br>Current: "+getBossLootChance().toFixed(0)+"%",r+="<br>Next Level: "+(getBossLootChance()+100*i).toFixed(0)+"%",r+="<br><br>Base Increased By: "+FormatNumberForDisplay(100*i)+"%";break;default:return e(t)}return r};var t=w.fnTooltipUpgradeElementDesc;w.fnTooltipUpgradeElementDesc=function(e){var n=t(e),a=$J(e),r=(g_Minigame.CurrentScene().m_rgTuningData.upgrades.slice(0),a.data("type")),i=lockedElement==r-3;return i?(n+="<br><br>This is your recommended element. Please upgrade this.",w.enableElementLock&&(n+="<br><br>Other elements are LOCKED to prevent accidentally upgrading.")):-1!=lockedElement&&(n+="<br><br>This is NOT your recommended element. DO NOT upgrade this."),n}}function getGameLevel(){return s().m_rgGameData.level+1}var SCRIPT_VERSION="4.1.0",clickRate=20,logLevel=1,enableAutoClicker=getPreferenceBoolean("enableAutoClicker",!0),removeInterface=getPreferenceBoolean("removeInterface",!0),removeParticles=getPreferenceBoolean("removeParticles",!0),removeFlinching=getPreferenceBoolean("removeFlinching",!0),removeCritText=getPreferenceBoolean("removeCritText",!1),removeGoldText=getPreferenceBoolean("removeGoldText",!1),removeAllText=getPreferenceBoolean("removeAllText",!1),enableAutoRefresh=getPreferenceBoolean("enableAutoRefresh","undefined"!=typeof GM_info),enableFingering=getPreferenceBoolean("enableFingering",!0),disableRenderer=getPreferenceBoolean("disableRenderer",!1),enableAutoUpdate=getPreferenceBoolean("enableAutoUpdate",!0),enableElementLock=getPreferenceBoolean("enableElementLock",!0),autoRefreshMinutes=30,autoRefreshMinutesRandomDelay=10,autoRefreshSecondsCheckLoadedDelay=30,isAlreadyRunning=!1,refreshTimer=null,currentClickRate=clickRate,lockedElement=-1,lastLevel=0,trt_oldCrit=function(){},trt_oldPush=function(){},trt_oldRender=function(){},control={speedThreshold:5e3,rainingRounds:250,timePerUpdate:6e4,useSlowMode:!1,minsLeft:30,allowWormholeLevel:25e3},remoteControlURL="http://steamcommunity.com/groups/MSG2015/discussions/0/598198356173574660",remoteControlURL2="http://steamcommunity.com/groups/MSG2015/discussions/0/598198356175571067",showedUpdateInfo=getPreferenceBoolean("showedUpdateInfo",!1),lane_info={},UPGRADES={LIGHT_ARMOR:0,AUTO_FIRE_CANNON:1,ARMOR_PIERCING_ROUND:2,DAMAGE_TO_FIRE_MONSTERS:3,DAMAGE_TO_WATER_MONSTERS:4,DAMAGE_TO_AIR_MONSTERS:5,DAMAGE_TO_EARTH_MONSTERS:6,LUCKY_SHOT:7,HEAVY_ARMOR:8,ADVANCED_TARGETING:9,EXPLOSIVE_ROUNDS:10,MEDICS:11,MORALE_BOOSTER:12,GOOD_LUCK_CHARMS:13,METAL_DETECTOR:14,DECREASE_COOLDOWNS:15,TACTICAL_NUKE:16,CLUSTER_BOMB:17,NAPALM:18,BOSS_LOOT:19,ENERGY_SHIELDS:20,FARMING_EQUIPMENT:21,RAILGUN:22,PERSONAL_TRAINING:23,AFK_EQUIPMENT:24,NEW_MOUSE_BUTTON:25},ABILITIES={FIRE_WEAPON:1,CHANGE_LANE:2,RESPAWN:3,CHANGE_TARGET:4,MORALE_BOOSTER:5,GOOD_LUCK_CHARMS:6,MEDICS:7,METAL_DETECTOR:8,DECREASE_COOLDOWNS:9,TACTICAL_NUKE:10,CLUSTER_BOMB:11,NAPALM:12,RESURRECTION:13,CRIPPLE_SPAWNER:14,CRIPPLE_MONSTER:15,MAX_ELEMENTAL_DAMAGE:16,RAINING_GOLD:17,CRIT:18,PUMPED_UP:19,THROW_MONEY_AT_SCREEN:20,GOD_MODE:21,TREASURE:22,STEAL_HEALTH:23,REFLECT_DAMAGE:24,FEELING_LUCKY:25,WORMHOLE:26,LIKE_NEW:27},BOSS_DISABLED_ABILITIES=["MORALE_BOOSTER","GOOD_LUCK_CHARMS","TACTICAL_NUKE","CLUSTER_BOMB","NAPALM","CRIT","CRIPPLE_SPAWNER","CRIPPLE_MONSTER","MAX_ELEMENTAL_DAMAGE","REFLECT_DAMAGE","THROW_MONEY_AT_SCREEN"],ENEMY_TYPE={SPAWNER:0,CREEP:1,BOSS:2,MINIBOSS:3,TREASURE:4};disableParticles(),w.SteamDB_Minigame_Timer&&w.clearInterval(w.SteamDB_Minigame_Timer),w.SteamDB_Minigame_Timer=w.setInterval(function(){g_Minigame&&s().m_bRunning&&s().m_rgPlayerTechTree&&s().m_rgGameData&&(w.clearInterval(w.SteamDB_Minigame_Timer),firstRun(),w.SteamDB_Minigame_Timer=w.setInterval(MainLoop,1e3))},1e3),w.setTimeout(function(){w.g_Minigame&&w.g_Minigame.m_CurrentScene&&w.g_Minigame.m_CurrentScene.m_rgGameData||w.location.reload(!0)},1e3*autoRefreshSecondsCheckLoadedDelay);var breadcrumbs=document.querySelector(".breadcrumbs");if(breadcrumbs){var element=document.createElement("span");element.textContent=" > ",breadcrumbs.appendChild(element),element=document.createElement("span"),element.style.color="#D4E157",element.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",element.textContent="Room "+g_GameID,breadcrumbs.appendChild(element)}}(window);